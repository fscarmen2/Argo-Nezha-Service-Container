#This is an example webapp.io configuration for Docker!
FROM vm/ubuntu:18.04

# To note: Layerfiles create entire VMs, *not* containers!

# install the latest version of Docker, as in the official Docker installation tutorial.
RUN apt-get update && \
    apt-get install ca-certificates curl gnupg lsb-release && \
    sudo mkdir -p /etc/apt/keyrings && \
    curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg && \
    echo \
    "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable" |\
      sudo tee /etc/apt/sources.list.d/docker.list > /dev/null && \
    apt-get update && \
    apt-get install docker-ce docker-ce-cli containerd.io

# copy files from the repository into this staging server
COPY . .

RUN docker build -t image .
RUN docker run -dit -p 80:80 \
           --name nezha_dashboard \
           --restart always \
           -e GH_USER=sh13026 \
           -e GH_EMAIL=907678247@qq.com \
           -e GH_PAT=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 \
           -e GH_REPO=nezha_backup \
           -e GH_CLIENTID=af77e042b3c15f165aaa  \
           -e GH_CLIENTSECRET=9f4de99e4b838e0ddd596407f5827c4b71d37552 \
           -e ARGO_AUTH='{"AccountTag":"d1840690d4b6fc3c7aa957c2358ea0a5","TunnelSecret":"NRYgYz8mMOIDfkNbnLbJ/R/85aVRQcWbFU652JFms00=","TunnelID":"3cb90b6e-ef95-49ca-b7e2-1a66fc444106"}' \
           -e WEB_DOMAIN=nezha.linjiangxian.fun \
           -e DATA_DOMAIN=data.linjiangxian.fun \
           -e SSH_DOMAIN=ssh.linjiangxian.fun \
           -e SSH_PASSWORD=sh13026 \
           image
EXPOSE WEBSITE http://localhost:80
